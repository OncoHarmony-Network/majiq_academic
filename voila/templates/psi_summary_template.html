{% extends "sg_lsv_sidebar_template.html" %}
{% block title %}MAJIQ LSV Gene Summary{% endblock %}
{% block css %}
    <link rel="stylesheet" type="text/css" href="static/css/splice.graph.D3.css"/>
    <link rel="stylesheet" type="text/css" href="static/css/bootstrap-frm.css"/>
{% endblock %}

{% block js %}
    <script src="static/js/splice.graph.js" type="text/javascript" language="javascript"></script>
    <script src="static/js/splice.graph.D3.js" type="text/javascript" language="javascript"></script>
    <script src="static/js/jquery.tablesorter.js" type="text/javascript"></script>
    <script src="static/js/jquery.tablesorter.pager.js" type="text/javascript"></script>
    <script src="static/js/application.js" type="text/javascript"></script>
    <script src="static/js/jquery.tooltipster.min.js" type="text/javascript"></script>
    <script src="static/js/clipboard.min.js" type="text/javascript"></script>
{% endblock %}

{% block header %}
    {% if namePage %}Result page: {{ namePage }}{% endif %}
{% endblock %}

{% block content %}
    <section>
        <fieldset class="section-border events-summary">
            <legend>LSV summary</legend>
            <div class="floatingCanvas">
                <canvas class="floatingLegend" width="500px" height="40px">
                    This browser or document mode doesn't support canvas
                </canvas>
            </div>

            {% for gene_id, gene_value in genes_dict.iteritems() %}
                {% if gene_id in genes_exps_list[0][genes_exps_list[0].keys()[0]].keys() %}
                    {% set gene_index = loop.index - 1 %}
                    <a name="{{ gene_value[0].name }}"></a>
                    <h2>Gene
                        name: {{ gene_value[0].name }}; {{ gene_value[0].chromosome }}:{{ gene_value[0].strand }}:{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_id].start }}-{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_id].end }};
                        {% if lexps %}
                            <a href="http://genome.ucsc.edu/cgi-bin/hgTracks?db={{ lexps.genome }}&position={{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_id][3] }}:{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_id].start }}-{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_id].end }}"
                               target="_blank"><img src="static/img/icons/ucsc3.png"
                                                    title="{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_id][3] }}:{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_id].start }}-{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_id].end }}"/></a>
                        {% endif %}
                    </h2>

                    <h3 class="gene_id">
                        Gene ID: {{ gene_id }};
                    </h3>

                    <div class="gene-container">

                        <div class="spliceGraphTools">

                            <select class="spliceGraphSelector exp1" autocomplete="off" title="splice graph selector">
                                {% for nsample in genes_exps_list[0] -%}
                                    {% if nsample == comb_spliceg_cond1 %}
                                        <option selected="selected"
                                                value="{{ genes_exps_list[0][nsample][gene_id] | to_json_especial }}">{{ nsample }}
                                        </option>
                                    {% else %}
                                        <option value="{{ genes_exps_list[0][nsample][gene_id] | to_json_especial }}">{{ nsample }}</option>
                                    {% endif %}
                                {%- endfor %}
                            </select>

                            {#                            <label class="toggleSwitch" title="Toggle from raw reads to corrected reads.">#}
                            {#                                RAW CORRECTED#}
                            {#                                <br/>#}
                            {#                                <input class="toggleSwitch readCounts" type="checkbox">#}
                            {#                                <div class="slider"></div>#}
                            {#                            </label>#}

                            <img class="toogleScale scaled" src="static/img/icons/solve-icon.png"
                                 title="Change between scaled view and a view where introns are trimmed"/>
                            <img class="zoomInSplice" src="static/img/zoom_in.png" title="Zoom in" alt=""/>
                            <img class="zoomOutSplice" src="static/img/zoom_out.png" title="Zoom out" alt=""/>
                            <img class="zoomResetSplice" src="static/img/undo.png" title="Zoom reset" alt=""/>
                            <div class="tooltipD3"><strong>Coordinates: </strong><span
                                    class="coordsLabel">-</span>;<strong>
                                Length: </strong><span class="lengthLabel">-;</span></div>
                        </div>

                        <div class="splice-div-container">
                            <div class="spliceDiv exp1" id="spliceDivExp1_{{ gene_index }}"
                                 data-exon-list="{{ genes_exps_list[0][comb_spliceg_cond1][gene_id] | to_json_especial }}">
                            </div>
                        </div>

                        <table id="event_table{{ loop.index }}" class="tablesorter">
                            <thead>
                            <tr>
                                <th class="short-header">Highlight</th>
                                <th class="short-header">LSV ID</th>
                                <th class="short-header">LSV Type</th>
                                <th class="short-header">&Psi; per Junction</th>
                                <th class="short-header">UCSC link</th>
                            </tr>
                            </thead>
                            <tfoot>
                            <tr>
                                <th>Highlight</th>
                                <th>LSV ID</th>
                                <th>LSV Type</th>
                                <th>&Psi; per Junction</th>
                                <th>UCSC link</th>
                            </tr>
                            </tfoot>
                            <tbody>
                            {% for lsv in gene_value %}
                                <tr class="{{ lsv.categories2css() }} lsvrow" data-njuncs="{{ lsv.njuncs() }}"
                                    data-nexons="{{ lsv.nexons() }}">
                                    <td>
                                        <form class='highlight-lsv'>
                                            <label>
                                                <input class="highlight" type="checkbox" value="highlight">
                                                Highlight
                                            </label>
                                            <label>

                                                <input class="weighted" type="checkbox" value="weighted">
                                                Weighted
                                            </label>
                                        </form>
                                    </td>
                                    <td>{{ lsv.lsv_id }}</td>
                                    <td>
                                        <p style="top:0;" class="hidden">{{ lsv.lsv_type }}</p>
                                        <canvas class="lsvLegend" id="{{ gene_index }}" width="200px" height="80px"
                                                data-lsv-string="{{ lsv.lsv_type }}"
                                                data-coord-exon="[{{ lsv.start }},{{ lsv.end }}]"
                                                title="{{ lsv.lsv_type }}">
                                            This browser or document mode doesn't support canvas
                                        </canvas>
                                    </td>
                                    <td id="data_td{{ gene_index }}{{ loop.index }}">
                                        <canvas class="lsvSingleCompactPercentiles"
                                                id="lsvSingleCompact{{ loop.index }}" width="50px"
                                                height="50px" data-lsv="[{{ lsv|to_json }}]"
                                                style="border: solid; border-width: 2pt; border-color: darkgrey;">
                                            This browser or document mode doesn't support canvas
                                        </canvas>
                                    </td>
                                    <td>
                                        <p>
                                            <a href="http://genome.ucsc.edu/cgi-bin/hgTracks?org=mouse&db={{ lexps.genome }}&position={{ lsv.chromosome }}:{{ lsv.get_extension()[0] }}-{{ lsv.get_extension()[1] }}"
                                               target="_blank">
                                                <img src="static/img/icons/ucsc3.png"
                                                     title="http://genome.ucsc.edu/cgi-bin/hgTracks?db={{ lexps.genome }}&position={{ lsv.chromosome }}:{{ lsv.get_extension()[0] }}-{{ lsv.get_extension()[1] }}"/>
                                            </a>
                                        </p>
                                        <p>
                                            <a href="../static/doc/lsvs/{{ lsv.gene_id }}.gtf" target="_blank"><img
                                                    src="static/img/icons/gtf.png"
                                                    title="Go to GFT LSV definition"/></a>
                                        </p>
                                        <p>

                                            <button class="copy-to-clipboard">
                                                <img src="static/img/icons/gtf.png"/>
                                            </button>
                                        </p>
                                    </td>

                                </tr>
                            {%- endfor %}
                            </tbody>
                        </table>
                        <div class="pager" id="pager{{ loop.index }}">
                            <form>
                                <img src="static/img/icons/first.png" class="first"/>
                                <img src="static/img/icons/prev.png" class="prev"/>
                                <input type="text" class="pagedisplay"/>
                                <img src="static/img/icons/next.png" class="next"/>
                                <img src="static/img/icons/last.png" class="last"/>
                                <select class="pagesize" autocomplete="off">

                                    {% for mark in tableMarks[gene_index] -%}
                                        {% if loop.first %}
                                            <option selected="selected" value="{{ mark }}">{{ mark }}</option>
                                        {% else %}
                                            <option value="{{ mark }}">{{ mark }}</option>
                                        {% endif %}
                                    {%- endfor %}
                                    <option value="{{ gene_value|length }}">All</option>
                                </select>
                            </form>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}

        </fieldset>
    </section>
{% endblock %}
