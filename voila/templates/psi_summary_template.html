{% extends "base_template.html" %}
{% block title %}MAJIQ LSV Gene Summary{% endblock %}
{% block css %}
<link rel="stylesheet" type="text/css" href="static/css/splice.graph.D3.css" />
<link rel="stylesheet" type="text/css" href="static/css/bootstrap-frm.css" />
{% endblock %}

{% block js %}
    <script src="static/js/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="static/js/splice.graph.js" type="text/javascript" language="javascript" ></script>
    <script src="static/js/splice.graph.D3.js" type="text/javascript" language="javascript" ></script>
    <script src="static/js/d3.v3.min.js" type="text/javascript" language="javascript" ></script>
    <script src="static/js/jquery.tablesorter.js" type="text/javascript"></script>
    <script src="static/js/jquery.tablesorter.pager.js" type="text/javascript"></script>
    <script src="static/js/application.js" type="text/javascript"></script>
    <script src="static/js/jquery.tooltipster.min.js" type="text/javascript"></script>

{% endblock %}

{% block header %}
        {% if namePage %}Result page: {{ namePage }}{% endif %}
{% endblock %}

{% block content %}
<section>
    <fieldset class="section-border events-summary">
        <legend>LSV summary</legend>
        <div class="floatingCanvas">
            <canvas class="floatingLegend" width="500px" height="40px">
                This browser or document mode doesn't support canvas
            </canvas>
        </div>

        <!--<p>Coordinates 0-based and closed interval</p>-->
        <!--<h2>LSV summary</h2>-->

        {% for gene_name, gene_value in genes_dict.iteritems() %}
            {% if gene_name in genes_exps_list[0][genes_exps_list[0].keys()[0]].keys() %}
                {% set gene_index = loop.index -1 %}
                {# genes_exps_list[0][genes_exps_list[0].keys()[0]].keys()| debug -#}
                <h2>Gene name: <a name="{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_name][4] }}">{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_name][4] }}</a>; {{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_name][3] }}:{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_name][1] }}:{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_name][2][0] }}-{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_name][2][1] }};
                    {% if lexps %}
                        <a href="http://genome.ucsc.edu/cgi-bin/hgTracks?db={{ lexps[0].genome }}&position={{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_name][3] }}:{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_name][2][0] }}-{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_name][2][1] }}" target="_blank"><img src="static/img/icons/ucsc3.png" title="{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_name][3] }}:{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_name][2][0] }}-{{ genes_exps_list[0][genes_exps_list[0].keys()[0]][gene_name][2][1] }}"/></a>
                    {% endif %}
                </h2>

                <h3 class="gene_id">
                    Gene ID: {{ gene_name }};
                </h3>


                <div>
                    <div class="spliceDiv" id="spliceDivExp1_{{ gene_index }}" data-exon-list="{{ genes_exps_list[0][comb_spliceg_cond1][gene_name][0] }}">
                        <span class="tooltipD3"><strong>Coordinates: </strong><span class="coordsLabel">-</span>;<strong> Length: </strong><span class="lengthLabel">-;</span></span>
                        <div class="spliceGraphTools">
                            <select class="spliceGraphSelector" autocomplete="off">
                                {% for nsample in genes_exps_list[0] -%}
                                    {% if nsample == comb_spliceg_cond1 %}
                                        <option selected="selected" value="{{ genes_exps_list[0][nsample][gene_name][0] |to_json}}">{{ nsample }}</option>
                                    {% else %}
                                        <option value="{{ genes_exps_list[0][nsample][gene_name][0] |to_json }}">{{ nsample }}</option>
                                    {% endif %}
                                {%- endfor %}
                            </select>
                            <img class="toogleScale scaled" src="static/img/icons/solve-icon.png" title="Change between scaled view and a view where introns are trimmed" />
                            <img class="zoomInSplice" src="static/img/zoom_in.png" title="Zoom in" alt="" />
                            <img class="zoomOutSplice" src="static/img/zoom_out.png" title="Zoom out" alt="" />
                            <img class="zoomResetSplice" src="static/img/undo.png" title="Zoom reset" alt="" />

                        </div>
                    </div>

                    <table id="event_table{{ loop.index }}" class="tablesorter">
                        <thead>
                        <tr>
                            <th class="short-header">LSV ID</th>
                            <th class="short-header">LSV Type</th>
                            <th class="short-header">&Psi; per Junction</th>
                            <th class="short-header">UCSC link</th>
                        </tr>
                        </thead>
                        <tfoot>
                        <tr>
                            <th>LSV ID</th>
                            <th>LSV Type</th>
                            <th>&Psi; per Junction</th>
                            <th>UCSC link</th>
                        </tr>
                        </tfoot>
                        <tbody>
                        {% for lsv in gene_value %}
                        <tr class="{{ lsv.categories2css() }} lsvrow" data-njuncs="{{ lsv.njuncs() }}" data-nexons="{{ lsv.nexons() }}">
                            <td>{{ lsv.get_id() }}</td>
                            <td>
                                <p style="top:0;" class="hidden">{{ lsv.get_type() }}</p>
                                <canvas class="lsvLegend" id="{{ gene_index }}" width="200px" height="80px" data-lsv-string="{{ lsv.get_type() }}" data-coord-exon="{{ lsv.get_coords() }}"  title="{{ lsv.get_type() }}">
                                    This browser or document mode doesn't support canvas
                                </canvas>
                            </td>
                            <td id="data_td{{ gene_index }}{{ loop.index }}">
                                <!--<img class="expandLsv" src="static/img/arrow_down.png" data-is-expanded=0/>-->
                                <canvas class="lsvSingleCompactPercentiles" id="lsvSingleCompact{{ loop.index }}" width="50px" height="50px" data-lsv="[{{ lsv|to_json }}]" style="border: solid; border-width: 2pt; border-color: darkgrey;" >
                                    This browser or document mode doesn't support canvas
                                </canvas>
                            </td>
                            <td>
                                <p>
                                    <a href="http://genome.ucsc.edu/cgi-bin/hgTracks?org=mouse&db={{ lexps[0].genome }}&position={{ lsv.get_chrom() }}:{{ lsv.get_extension()[0] }}-{{ lsv.get_extension()[1] }}" target="_blank">
                                        <img src="static/img/icons/ucsc3.png" title="http://genome.ucsc.edu/cgi-bin/hgTracks?db={{ lexps[0].genome }}&position={{ lsv.get_chrom() }}:{{ lsv.get_extension()[0] }}-{{ lsv.get_extension()[1] }}"/>
                                    </a>
                                </p>
                                <p>
                                    <a href="static/doc/lsvs/{{ lsv.get_id() }}.gtf" target="_blank"><img src="static/img/icons/gtf.png" title="Go to GFT LSV definition"/></a>
                                </p>
                            </td>

                        </tr>
                        {%- endfor %}
                        </tbody>
                    </table>
                    <div class="pager" id="pager{{ loop.index }}">
                        <form>
                            <img src="static/img/icons/first.png" class="first"/>
                            <img src="static/img/icons/prev.png" class="prev"/>
                            <input type="text" class="pagedisplay"/>
                            <img src="static/img/icons/next.png" class="next"/>
                            <img src="static/img/icons/last.png" class="last"/>
                            <select class="pagesize" autocomplete="off">

                                {% for mark in tableMarks[gene_index] -%}
                                    {% if loop.first %}
                                        <option selected="selected"  value="{{ mark }}">{{ mark }}</option>
                                    {% else %}
                                        <option value="{{ mark }}">{{ mark }}</option>
                                    {% endif %}
                                {%- endfor %}
                                <option value="{{ gene_value|length }}">All</option>
                            </select>
                        </form>
                    </div>
                </div>
            {% endif %}
        {% endfor %}

    </fieldset>
</section>
<aside class="filters">
    <fieldset class="section-border">
        <legend>LSV filters</legend>
        <form id="lsv-filters" class="bootstrap-frm">
            <label><input type="checkbox" name="prime5" value="1" checked>5-prime</label><br>
            <label><input type="checkbox" name="prime3" value="1" checked>3-prime</label><br>
            <label><input type="checkbox" name="ES" value="1" checked>Exon skipping</label><br>
            <label><input type="checkbox" name="source" value="1" checked>Single Source</label><br>
            <label><input type="checkbox" name="target" value="1" checked>Single Target</label><br>
            <span>Number of junctions:</span><br>
            <label><span>from:</span><input type="text" name="njuncsfrom" value="" size="4"></label>
            <label><span>to:</span><input type="text" name="njuncsto" size="4"></label><br>
            <span>Number of exons:</span><br>
            <label><span>from:</span><input type="text" name="nexonsfrom" value="" size="4"></label>
            <label><span>to:</span><input type="text" name="nexonsto" size="4"><br></label>
        </form>
    </fieldset>
    {% if prevPage or nextPage %}
        <fieldset class="section-border">
            <legend>Summaries</legend>
            {% if prevPage %}
            <a href="{{ prevPage }}" class="prevPage">&#x276e; Previous</a>
            {% endif %}
            {% if nextPage %}
            <a href="{{ nextPage }}" class="nextPage">Next &#x276f;</a>
            {% endif %}
        </fieldset>
    {% endif %}
</aside>
{% endblock %}

