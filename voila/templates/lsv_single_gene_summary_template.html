{% extends "base_template.html" %}
{% block title %}MAJIQ LSV Gene Summary{% endblock %}
{% block css %}
    {# Evaluate if we should divide different css in files #}
{% endblock %}

{% block js %}
    <script src="static/js/jquery-1.10.2.js" type="text/javascript"></script>
    <script src="static/js/splice.graph.js" type="text/javascript" language="javascript" ></script>
    <script type="text/javascript" language="javascript" src="http://d3js.org/d3.v3.min.js" ></script>
    <script src="static/js/jquery.tablesorter.js" type="text/javascript"></script>
    <script src="static/js/jquery.tablesorter.pager.js" type="text/javascript"></script>
    <script src="static/js/application.js" type="text/javascript"></script>

{% endblock %}

{% block content %}


    <div class="events-summary">
        <div class="floatingCanvas">
            <canvas class="floatingLegend" width="500px" height="40px">
                This browser or document mode doesn't support canvas
            </canvas>
        </div>

        <!--<p>Coordinates 0-based and closed interval</p>-->
        <h2>LSV summary</h2>
        <h3>Result pages:
            {% if prevPage %}
                <a href="{{ prevPage }}">Previous &lt&lt</a>
            {% endif %}
            {% if nextPage and prevPage %}|{% endif %}
            {% if nextPage %}
                <a href="{{ nextPage }}">&gt&gt Next</a>
            {% endif %}
        </h3>


        {% for gene_name, gene_value in genes_dict.iteritems() %}
            {% set gene_index = loop.index -1 %}
            {{ gene_value[0][0]|debug }}
            <h2>Gene name: {{ gene_name }}; Strand: {{ genes_json[gene_name][1] }};
                {# <!-- TODO: Replace hardcoded organism and species with metadata --> #}
                <a href="http://genome.ucsc.edu/cgi-bin/hgTracks?org=mouse&db=mm10&position={{ gene_value[0][1][3] }}:{{ genes_json[gene_name][2][0] }}-{{ genes_json[gene_name][2][1] }}" target="_blank"><img src="static/img/icons/ucsc2.png" title="{{ gene_value[0][1][3] }}:{{ genes_json[gene_name][2][0] }}-{{ genes_json[gene_name][2][1] }}"/></a>
                <a href="http://www.ensembl.org/Mus_musculus/transview?transcript={{ gene_name }}" target="_blank"><img src="static/img/icons/ensembl.jpg" title="http://www.ensembl.org/Mus_musculus/transview?transcript={{ gene_name }}"/></a>
            </h2> {# {{ gene_value[0][0].strand }} #}
            <canvas class="spliceGraph" width="1000px" height="200px" data-exon-list="{{ genes_json[gene_name][0] }}">
                This browser or document mode doesn't support canvas
            </canvas>

            <table id="event_table{{ loop.index }}" class="tablesorter">
                <thead>
                <tr>
                    <th class="short-header">LSV ID</th>
                    <th class="short-header">Type</th>
                    <th class="short-header"></th>
                    <th class="short-header">UCSC link</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                    <th>LSV ID</th>
                    <th>Type</th>
                    <th></th>
                    <th>UCSC link</th>
                </tr>
                </tfoot>
                <tbody>
                {% for gene in gene_value %}
                <tr>
                    <td>{{ gene[1][1] }}</td>
                    <td>
                        <p class="hidden" style="top:0;">{{ gene[1][2] }}</p>
                        <a href="http://genome.ucsc.edu/cgi-bin/hgTracks?org=mouse&db=mm10&position={{ gene_value[0][1][3] }}:{{ gene[0].extension[0] }}-{{ gene[0].extension[1] }}" target="_blank"><img src="static/img/icons/ucsc2.png" title="http://genome.ucsc.edu/cgi-bin/hgTracks?org=mouse&db=mm10&position={{ gene_value[0][1][3] }}:{{ gene[0].extension[0] }}-{{ gene[0].extension[1] }}"/></a>
                        <canvas class="lsvLegend" id="{{ gene_index }}" width="300px" height="150px" data-lsv-string="{{ gene[1][2] }}" data-coord-exon="{{ gene[1][0] }}">
                            This browser or document mode doesn't support canvas
                        </canvas>
                    </td>
                    <td id="data_td{{ gene_index }}{{ loop.index }}">
                        <!--<img class="expandLsv" src="static/img/arrow_down.png" data-is-expanded=0/>-->
                        <canvas class="lsvSingleCompactPercentiles" id="lsvSingleCompact{{ loop.index }}" width="100px" height="100px" style="border: solid; border-width: 2pt; border-color: darkgrey;" data-lsv="[{{ gene[0]|to_json }}]" >
                            This browser or document mode doesn't support canvas
                        </canvas>
                    </td>
                    <td>
                        <a href="http://genome.ucsc.edu/cgi-bin/hgTracks?org=mouse&db=mm10&position={{ gene[1][3] }}:{{ gene[1][0][0] }}-{{ gene[1][4] }}" target="_blank">{{ gene[1][3] }}:{{ gene[1][0][0] }}-{{ gene[1][4] }}</a>
                    </td>

                </tr>
                {%- endfor %}
                </tbody>
            </table>
            <div class="pager" id="pager{{ loop.index }}">
                <form>
                    <img src="static/img/icons/first.png" class="first"/>
                    <img src="static/img/icons/prev.png" class="prev"/>
                    <input type="text" class="pagedisplay"/>
                    <img src="static/img/icons/next.png" class="next"/>
                    <img src="static/img/icons/last.png" class="last"/>
                    <select class="pagesize" autocomplete="off">

                        {% for mark in tableMarks[gene_index] -%}
                            {% if loop.first %}
                                <option selected="selected"  value="{{ mark }}">{{ mark }}</option>
                            {% else %}
                                <option value="{{ mark }}">{{ mark }}</option>
                            {% endif %}
                        {%- endfor %}
                        <option value="{{ gene_value|length }}">All</option>
                    </select>
                </form>
            </div>

        {% endfor %}

    </div>
{% endblock %}

